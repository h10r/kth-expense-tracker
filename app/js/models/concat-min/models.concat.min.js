expenseTrackerAppModule.service("categoriesModel",function(){"use strict";var currentCategory,nextIDCounter=6,categories=[],category={id:-1,title:"",color_id:"",icon:"",custom:null},availableColors=[];return availableColors.push({id:0,title:"turquoise",color_value:"#1abc9c"},{id:1,title:"green sea",color_value:"#16a085"},{id:2,title:"emerland",color_value:"#2ecc71"},{id:3,title:"nephritis",color_value:"#27ae60"},{id:4,title:"peter priver",color_value:"#3498db"},{id:5,title:"belize hole",color_value:"#2980d9"},{id:6,title:"sun flower",color_value:"#f1c40f"},{id:7,title:"orange",color_value:"#f39c12"},{id:8,title:"carrot",color_value:"#d35400"},{id:9,title:"alazarin",color_value:"#e74c3c"},{id:10,title:"pomegranate",color_value:"#c0392b"},{id:11,title:"amethyst",color_value:"#9b59b6"},{id:12,title:"grey",color_value:"#CCC"}),categories.push({id:0,title:"groceries",color_id:1,icon:"fa-shopping-cart",custom:!1},{id:1,title:"eating out",color_id:6,icon:"fa-cutlery",custom:!1},{id:2,title:"coffee",color_id:8,icon:"fa-coffee",custom:!1},{id:3,title:"beer",color_id:7,icon:"fa-beer",custom:!1},{id:4,title:"cell phone",color_id:4,icon:"fa-phone",custom:!1},{id:5,title:"other",color_id:12,icon:"fa-ellipsis-h",custom:!1}),{initNewCategory:function(){return currentCategory=jQuery.extend(!0,{},category),currentCategory.id=nextIDCounter,nextIDCounter+=1,currentCategory.custom=!0,currentCategory},saveCurrentCategoryToCollection:function(){currentCategory.initial=currentCategory.title.charAt(0),categories.push(currentCategory)},removeCategoryFromCollection:function(categoryId){for(var key in categories)categories[key].id===parseInt(categoryId,10)&&categories.splice(categories.indexOf(categories[key]),1)},setCategoryColorById:function(colorId){currentCategory.color_id=colorId},getAvailableColors:function(){return availableColors},listCategories:function(){return categories},getCategoryById:function(categoryId){for(var key in categories)if(categories[key].id===categoryId)return categories[key]},getCategoryColorById:function(colorId){for(var key in availableColors)if(availableColors[key].id===colorId)return availableColors[key]}}}),expenseTrackerAppModule.service("currenciesModel",function(){"use strict";var currencies=[];return currencies.push({id:0,name:"Euro",sign:"€",token:"EUR",position:"right"},{id:1,name:"US Dollar",sign:"$",token:"USD",position:"left"},{id:2,name:"Swedish Kronor",sign:"kr",token:"SEK",position:"right"},{id:3,name:"Japanese Yen",sign:"¥",token:"JPY",position:"right"},{id:4,name:"British Pound",sign:"£",token:"GBP",position:"left"},{id:5,name:"Swiss Franc",sign:"SFr",token:"CHF",position:"right"},{id:6,name:"Canadian Dollar",sign:"$",token:"CAD",position:"left"},{id:7,name:"Australian Dollar",sign:"$",token:"AUD",position:"left"},{id:8,name:"New Zealand Dollar",sign:"$",token:"NZD",position:"left"},{id:9,name:"South African Rand",sign:"R",token:"ZAR",position:"right"}),{getCurrenciesList:function(){return currencies},getCurrencyById:function(currencyId){for(var key in currencies)if(currencies[key].id===currencyId)return currencies[key]}}}),expenseTrackerAppModule.service("expensesModel",function(categoriesModel,userModel){"use strict";function range(start,end){for(var foo=[],i=start;end>=i;i++)foo.push(i);return foo}function rangeEmpty(start,end){for(var foo=[],i=start;end>=i;i++)foo.push("");return foo}var currentExpense,spendingStats,nextIDCounter=9,categoryColors=categoriesModel.getAvailableColors(),expenses=[],expense={id:-1,amount:0,time:null,date:null,location:null,description:null,category_id:null};return expenses.push({id:0,amount:123,time:"10:33:51 AM",date:new Date(2014,2,10),location:null,description:null,category_id:2},{id:1,amount:45,time:"11:33:51 AM",date:new Date(2014,2,10),location:null,description:null,category_id:2},{id:2,amount:301,time:"10:44:51 AM",date:new Date(2014,2,11),location:null,description:null,category_id:3},{id:3,amount:21,time:"7:33:51 AM",date:new Date(2014,2,12),location:null,description:null,category_id:1},{id:4,amount:79,time:"3:33:51 PM",date:new Date(2014,2,13),location:null,description:null,category_id:3},{id:5,amount:103,time:"8:03:51 AM",date:new Date(2014,2,15),location:null,description:null,category_id:0},{id:6,amount:73,time:"10:33:51 AM",date:new Date(2014,2,15),location:null,description:null,category_id:2},{id:7,amount:137,time:"10:33:51 AM",date:new Date(2014,2,16),location:null,description:null,category_id:4},{id:8,amount:89,time:"10:33:51 AM",date:new Date(2014,2,17),location:null,description:null,category_id:1}),Date.prototype.monthDays=function(){var d=new Date(this.getFullYear(),this.getMonth()+1,0);return d.getDate()},Date.prototype.getWeek=function(){var determinedate=new Date;determinedate.setFullYear(this.getFullYear(),this.getMonth(),this.getDate());var D=determinedate.getDay();0==D&&(D=7),determinedate.setDate(determinedate.getDate()+(4-D));var YN=determinedate.getFullYear(),ZBDoCY=Math.floor((determinedate.getTime()-new Date(YN,0,1,-6))/864e5),WN=1+Math.floor(ZBDoCY/7);return WN},{initNewExpense:function(){return currentExpense=jQuery.extend(!0,{},expense),currentExpense.id=nextIDCounter,nextIDCounter+=1,currentExpense},getCurrentExpense:function(){return currentExpense},getExpenses:function(){return expenses.reverse()},getAmount:function(){return currentExpense.amount},setAmount:function(newAmount){currentExpense.amount=newAmount},getCategory:function(){return currentExpense.category_id},setCategory:function(newCategory){currentExpense.category_id=newCategory},addExpenseToCollection:function(){expenses.push(currentExpense)},removeExpenseFromCollection:function(expenseId){for(var key in expenses)expenses[key].id==expenseId&&expenses.splice(expenses.indexOf(expenses[key]),1)},getExpenseById:function(expenseId){for(var key in expenses)if(expenses[key].id==expenseId)return expenses[key]},getExpensesChronologically:function(){var chronologicalExpenses=expenses;return chronologicalExpenses.sort(function(a,b){return b.date-a.date}),chronologicalExpenses},getExpensesByCategory:function(){var categories=categoriesModel.listCategories(),dataArray=[];for(var category in categories){var sum=0;for(var id in expenses)expenses[id].category_id==category&&(sum+=expenses[id].amount);dataArray[category]={value:sum,color:categoryColors[categories[category].color_id].color_value}}return dataArray},getExpensesByTime:function(){var data={labels:["Mo","Tu","We","Th","Fr","Sa","Su"],datasets:[{fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:this.getPreviousWeeksExpenses()},{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:this.getThisWeeksExpenses()}]};return data},getExpensesByBudget:function(){var currentDay=(new Date).getDate(),budgetGrad=this.calculateAverageSpendingPerDay().optimalSpendingPerDayByBudget,budgetGradArray=$.map(range(1,30),function(n){return n*budgetGrad}),monthlyGrad=this.calculateAverageSpendingPerDay().averageSpendingPerDay,monthlyGradArray=$.map(range(1,currentDay),function(n){return n*monthlyGrad}),data={labels:rangeEmpty(1,30),datasets:[{fillColor:"rgba(245,49,49,0.5)",strokeColor:"rgba(245,49,49,1)",pointColor:"rgba(245,49,49,1)",pointStrokeColor:"#fff",data:monthlyGradArray},{fillColor:"rgba(151,187,205,0.3)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:budgetGradArray}]};return data},getThisWeeksExpenses:function(){var currentDate=new Date,currentWeekNumber=currentDate.getWeek(),expenses=this.getExpenses(),weekData=[0,0,0,0,0,0,0];for(var idx in expenses)if("string"==typeof expenses[idx].date&&(expenses[idx].date=new Date(expenses[idx].date)),expenses[idx].date.getWeek()==currentWeekNumber){var dayIndex=expenses[idx].date.getDay()-1;weekData[dayIndex]+=expenses[idx].amount}return weekData},getPreviousWeeksExpenses:function(){var currentDate=new Date,currentWeekNumber=currentDate.getWeek()-1,expenses=this.getExpenses(),weekData=[0,0,0,0,0,0,0];for(var idx in expenses)if("string"==typeof expenses[idx].date&&(expenses[idx].date=new Date(expenses[idx].date)),expenses[idx].date.getWeek()==currentWeekNumber){var dayIndex=expenses[idx].date.getDay()-1;weekData[dayIndex]+=expenses[idx].amount}return weekData},getWeeklyTotals:function(){var thisWeek=this.getThisWeeksExpenses(),lastWeek=this.getPreviousWeeksExpenses(),thisWeekTotal=0,lastWeekTotal=0;for(var i in thisWeek)thisWeekTotal+=thisWeek[i],lastWeekTotal+=lastWeek[i];return[thisWeekTotal,lastWeekTotal]},getMonthlyTotal:function(month){var currentDate,i,monthlyTotal=0,expenses=this.getExpenses();for(void 0===month&&(currentDate=new Date,month=currentDate.getMonth()),i=0;i<expenses.length;i++)"string"==typeof expenses[i].date&&(expenses[i].date=new Date(expenses[i].date)),expenses[i].date.getMonth()===month&&(monthlyTotal+=expenses[i].amount);return monthlyTotal},calculateAverageSpendingPerDay:function(){var NO_OF_DAYS=30,userBudget=userModel.getBudget();expenses.sort(function(a,b){return new Date(b.date)-new Date(a.date)});var oneMonthAgoDate=new Date;oneMonthAgoDate.setMonth(oneMonthAgoDate.getMonth()-1);for(var sumOfExpenses=0,i=0;NO_OF_DAYS>i;i++)void 0!==expenses[i]&&expenses[i].date>oneMonthAgoDate&&(sumOfExpenses+=expenses[i].amount);var averageSpendingPerDay=Math.ceil(sumOfExpenses/NO_OF_DAYS),optimalSpendingPerDayByBudget=Math.ceil(userBudget/NO_OF_DAYS),spendingDelta=optimalSpendingPerDayByBudget-averageSpendingPerDay;return spendingStats={spendingDelta:spendingDelta,averageSpendingPerDay:averageSpendingPerDay,optimalSpendingPerDayByBudget:optimalSpendingPerDayByBudget}},getAverageSpendingPerDay:function(){return spendingStats.averageSpendingPerDay},getOptimalSpendingPerDayByBudget:function(){return spendingStats.optimalSpendingPerDayByBudget},getSavingsPerDay:function(){return spendingStats.spendingDelta}}}),expenseTrackerAppModule.service("goalsModel",function(expensesModel){"use strict";var currentGoal,nextIDCounter=0,goals=[],goal={id:-1,target:"",description:""};return{initNewGoal:function(){return currentGoal=jQuery.extend(!0,{},goal),currentGoal.id=nextIDCounter,nextIDCounter+=1,currentGoal},saveCurrentGoalToCollection:function(target,description){currentGoal.target=target,currentGoal.description=description,goals.push(currentGoal)},removeGoalFromCollection:function(GoalId){for(var key in goals)goals[key].id===parseInt(GoalId,10)&&goals.splice(goals.indexOf(goals[key]),1)},calculateDaysUntilGoalIsReached:function(target,spendingPerDay){var daysUntilGoalIsReached=Math.floor(target/spendingPerDay);return daysUntilGoalIsReached},getAllGoals:function(){var spendingStats=expensesModel.calculateAverageSpendingPerDay();for(var key in goals)goals[key].daysUntilGoalIsReached=this.calculateDaysUntilGoalIsReached(goals[key].target,spendingStats.spendingDelta);return goals.sort(function(a,b){return a.daysUntilGoalIsReached-b.daysUntilGoalIsReached}),goals}}}),expenseTrackerAppModule.service("knobModel",function(expensesModel){"use strict";var infiniteValue,v,up,down,$ival,now=new Date,resetKnob=function(element){infiniteValue=0,up=0,down=0,now=new Date,$ival=element},incr=function(){infiniteValue++,updateValue()},decr=function(){0!==expensesModel.getAmount()&&(infiniteValue--,updateValue())},updateValue=function(){var newValue=infiniteValue;$ival.html(newValue),expensesModel.setAmount(newValue)},changeEventHandler=function(){v>this.cv?up?(decr(),up=0):(up=1,down=0):v<this.cv&&(down?(incr(),down=0):(down=1,up=0)),v=this.cv};return{initialize:function(element){resetKnob(element),$(".infinite").knob({min:0,max:30,width:230,height:230,stopper:!1,cursor:30,inline:!1,fgColor:"#0fb2be",bgColor:"#e6e6e7",displayInput:!1,change:changeEventHandler})}}}),expenseTrackerAppModule.service("navigationService",function(){"use strict";return{goBack:function(){window.history.back()}}}),expenseTrackerAppModule.service("userModel",function(){"use strict";var currentUser={firstName:"",lastName:"",eMailAddress:"",budget:0,token:"",currency:2};return{getCurrentUser:function(){return currentUser},getFirstName:function(){return currentUser.firstName},setFirstName:function(value){currentUser.firstName=value},getLastName:function(){return currentUser.lastName},setLastName:function(value){currentUser.lastName=value},getEMailAddress:function(){return currentUser.eMailAddress},setEMailAddress:function(value){currentUser.eMailAddress=value},getBudget:function(){return currentUser.budget},setBudget:function(value){currentUser.budget=value},isBudgetSet:function(){return 0!==currentUser.budget},getCurrency:function(){return currentUser.currency},setCurrency:function(currencyId){currentUser.currency=currencyId}}});